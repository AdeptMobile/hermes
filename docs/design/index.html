<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-design">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Design Overview | Hermes</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://hermesengine.dev/docs/design"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Design Overview | Hermes"><meta data-rh="true" name="description" content="This is the design document for the Hermes Engine."><meta data-rh="true" property="og:description" content="This is the design document for the Hermes Engine."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hermesengine.dev/docs/design"><link data-rh="true" rel="alternate" href="https://hermesengine.dev/docs/design" hreflang="en"><link data-rh="true" rel="alternate" href="https://hermesengine.dev/docs/design" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.c0bb9412.css">
<link rel="preload" href="/assets/js/runtime~main.79f494e2.js" as="script">
<link rel="preload" href="/assets/js/main.c24be046.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Hermes Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Hermes Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Hermes</b></a><a class="navbar__item navbar__link" href="/docs/building-and-running">Docs</a><a class="navbar__item navbar__link" href="/playground/">Playground</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/hermes" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/building-and-running">Documentation</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/building-and-running">Building and Running</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/emscripten">Building with Emscripten</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cross-compilation">Cross Compilation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/language-features">Language Features</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/intl">Internationalization APIs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/memory-profilers">Memory Profilers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/design">Design Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ir">Design of the IR</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/optimizer">Design of the Optimizer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/vm">VM Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gengc">The GenGC Garbage Collector</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/hades">The Hades Garbage Collector</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/modules">Modules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/strings">Strings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/regexp">RegExp</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/react-native-integration">Integrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/coding-standards">Contributing</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Documentation</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Design Overview</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Design Overview</h1></header><p>This is the design document for the Hermes Engine.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="json-estree-parser">JSON estree parser<a href="#json-estree-parser" class="hash-link" aria-label="Direct link to JSON estree parser" title="Direct link to JSON estree parser">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="javascript-parser">JavaScript parser<a href="#javascript-parser" class="hash-link" aria-label="Direct link to JavaScript parser" title="Direct link to JavaScript parser">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="irgen">IRGen<a href="#irgen" class="hash-link" aria-label="Direct link to IRGen" title="Direct link to IRGen">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="hermes-bytecode-generator">Hermes Bytecode Generator<a href="#hermes-bytecode-generator" class="hash-link" aria-label="Direct link to Hermes Bytecode Generator" title="Direct link to Hermes Bytecode Generator">​</a></h2><p>The Hermes bytecode generator is responsible for translating the
Hermes high-level IR into Hermes bytecode. This section only describes the
generation of the opcode stream, not the whole bundle file format that is
described in a separate document.</p><p>The bytecode is a register-based bytecode. The number of registers is
infinite, but there are some restrictions on the registers. For example,
registers that are allocated to call instructions must be consecutive, and most
instructions only accept an 8-bit register index.</p><p>The first phase of bytecode generation is lowering of some instructions to
target-specific instructions. Next, the register allocator allocates
registers for each instruction in the lowered IR. Notice that the Hermes IR
has a single return value per instruction. We model multiple return values or
in-out variables using alloc-stack instructions.</p><p>One interesting design decision here is that register allocation happens on the
IR prior to instruction selection. Performing register allocation prior to
lowering is often done in JIT compilers where the lowering phase is trivial and
close to a 1:1 translation between high-level IR and the low-level target IR.
The lowered Hermes IR is very close to the bytecode format with a few
exceptions: the handling of variables, the representation of constants and the
representation of stack-allocated variables. Stack allocated registers are
implemented as values that are pinned into a specific registers (at least during
the lifetime of the stack allocation). Load/Store instructions from the stack
allocation values are lowered into MOV instructions.</p><p>The current register allocation implementation is a very simple linear scan. The
allocation has four main steps. First, we number the instructions in the
functions, and traverse the basic blocks in the function in reverse-post-order
scan.  Second, we calculate the liveness graph of the result of each
instruction in the function. We propagate this information across the function
with a simple data-flow scan.  Third, we calculate the liveness interval of each
instruction. Finally, we scan the instructions in the function one by one and
assign registers. We maintain a list of currently live intervals that correspond
to the register file. We represent the register file with a simple bit vector
and prefer to allocate registers from the beginning of the file.  When we run out
of registers we simply allocate new registers. When we reach instructions that
require target-specific handling we call the backend to fill in the details. For
example, the Hermes backend handles call instructions in a special way.  At the
moment we do not coalesce values and our PHI nodes generate two MOVs.</p><p>After register allocation we lower the Hermes IR into pseudo opcodes using a
one-to-one or one-to-many translation. There are a few interesting optimizations
during this translation.  The first interesting optimization is the optimization
that eliminates redundant constant jumps. It is possible to eliminate many
branches by scheduling basic blocks in a way that maximizes the number of
fall-through opportunities. The current algorithm uses a greedy approach where
we emit basic blocks in some order (that starts with the entry block), and
attempt to place the fall-through destination right after terminators that
branch (conditional and unconditional branches) if the block has not been
generated already. In the future we may need to investigate if this greedy
algorithm is optimal.</p><p>When we generate the opcode stream we need to encode jump targets. However, when
we emit opcodes that refer to jump destinations that we have not yet emitted
then we do not know the address of the destination. We solve this problem by
emitting a dummy value and keeping a side-table that saves the location that we
need to patch. When we finish emitting all of the opcodes we scan the side table
and patch all of the locations that refer to previously unresolved addresses.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hermes-bytecode-instructions">Hermes Bytecode Instructions<a href="#hermes-bytecode-instructions" class="hash-link" aria-label="Direct link to Hermes Bytecode Instructions" title="Direct link to Hermes Bytecode Instructions">​</a></h3><p>Hermes bytecode adopts variable-length instructions. Each operand to a bytecode
instruction has a fixed-type and width, defined by the opcode. For instance,
Jmp takes a 1-byte offset as the jump target, while JmpLong takes a 4-byte
offset as the jump target.  Fixed-type/width instructions allow us to decode
them efficiently in the interpreter.
However we are trading off with an increasing number of
opcodes to handle different operand widths (e.g. two Jmp opcodes instead of
one). We believe that we are able to avoid opcode explosion by generating the
code smartly. A full list of Hermes bytecode opcodes can be found in
BytecodeList.def. There are a few interesting design decisions worth mentioning
here:</p><ul><li>Registers: We discovered that in all of the Facebook mobile JS code as well as
majority of external benchmarks, no function ever uses more than 256 registers.
Hence we always use 1-byte to represent register index, which will be most
efficient for the normal cases. Spilling is implemented via MovLong which
supports 32 bit register indices.</li><li>Constants: we achieve constant loading fully through instructions.
For fixed-value constants such as undefined, null, true and false, we introduce
a corresponding load opcode for each of them into a register (e.g.
LoadConstUndefined <code>dstReg</code>); For 32-bit integers, we introduce LoadConstInt
opcode, which takes a 4-bytes immediate value and load it into a register; for
doubles, we introduce LoadConstDouble, which takes a 8-bytes immediate value
and load it into a register; finally for strings, we introduce LoadConstString,
which takes an index to the string table from which to load into a register.
Doing so can significantly reduce the size of the bytecode, however it does
introduce a few more opcodes which could slow down the interpreter.</li><li>Non-local Variable Access: Local variables are translated to registers.
Non-local variables are variables from different scopes/environments. Without a
compiler, accessing non-local variables in JavaScript usually means a scope
lookup (i.e. locating the closest scope in the scope chain that defines the
variable), followed by a symbol lookup in that scope.
However with a compiler, it is possible to statically determine the scope of
every variable, and hence there is no need for a real scope lookup. In Hermes
backend, for each non-local variable access, we simply calculate the delta
between the defining scope and the current scope, and locate such scope using
the delta (i.e. number of times the VM needs to follow the scope chain)
directly. Furthermore, since we know exactly what and how many variables are
defined in each scope (except the global scope), we skip the symbol lookup in
the scope but instead using a direct index access to retrieve such variable in
the located scope. We believe that skipping both scope lookups and symbol
lookups can significantly improve the runtime performance.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bytecode-file-format">Bytecode File Format<a href="#bytecode-file-format" class="hash-link" aria-label="Direct link to Bytecode File Format" title="Direct link to Bytecode File Format">​</a></h3><p>The bytecode file contains the bytecode as well as necessary metadata and
auxiliary data sections for the VM to execute properly. The file format is
defined in BytecodeFileFormat.h, and structures as following:</p><ul><li>FILE HEADER: The file header contains the MAGIC, the current format version,
and a list of global metadata, including the file size, offset of the function
header table, offset of the string table, index of the global code and number
of functions.</li><li>FUNCTION HEADER TABLE: This is a list of function headers. Each function header
contains metadata of a function, such as the offset of the function bytecode in
the file, number of parameters, size of the frame/environment, size of the
bytecode and etc. This list also naturally assigns an index to each function in
the file, which makes access to each function convenient in the VM.</li><li>STRING TABLE&amp;STORAGE: All the strings used in all functions are uniqued and
stored in the section to avoid redundant string storage. This section contains
two parts: The string storage, which is a long sequence of raw characters; the
string table, which is a list of pairs, each pair represents a string through
the offset to the string storage and the length of the string. The string table
also naturally assigns an index to each unique string, which makes it
convenient to refer to the strings in the bytecode.</li><li>FUNCTION BYTECODES: This section is the core section of the bytecode file,
containing a list of compiled function body. The function body contains its
executable bytecode, along with a few tables that are used by the bytecode,
including the exception handler table (tells where to jump to when exception
happens), the array buffer (used to initialize constant arrays). Likely there
will be a few more tables coming to support RegExp and debug information.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="serialization--deserialization">Serialization / Deserialization<a href="#serialization--deserialization" class="hash-link" aria-label="Direct link to Serialization / Deserialization" title="Direct link to Serialization / Deserialization">​</a></h3><p>Because the Hermes backend is in the same codebase as the VM, there are
opportunities for us to share code between them. In particular, we want the
serialization in the backend to be able to share the same target data structure
as the deserialization in the VM. This introduces some interesting questions:</p><ul><li>How can we share data/code without having to link too much code on each side?</li><li>How to avoid data copies during both serialization and deserialization?</li></ul><p>We introduce two design pieces to achieve code sharing efficiently:</p><ul><li>Generator: During serialization, we often need many auxiliary data and
functionality to aid the process, though many of that will not be needed in the
end. To ensure the separation of the complexity and allow the deserialization
to share data/code most efficiently, we use a BytecodeModuleGenerator and a
list of BytecodeFunctionGenerator for the purpose of generating bytecode and
serialization. After all the processing, they will eventually generate a
BytecodeModule and a list of BytecodeFunction that contains minimum amount of
data/functionality required to generate the bytecode file. Hence we can share
this minimum data structure between the backend and the VM.</li><li>StreamVector: During serialization, we need to move/copy the part of the
auxiliary data  from the generator to the shared minimum data structure; during
deserialization, we need to move/copy the content of the file into the shared
minimum data structure. Both can be expensive if not managed properly. To
minimize the copying overhead, we abstracted the complexity using a class named
StreamVector. During serialization, StreamVector allows us to move the data out
of the generator without copying (through std::vector::swap); during
deserialization, StreamVector allows us to take in a raw data pointer to the
memory buffer from the file directly, without having to copy them too.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="interaction-with-the-vm">Interaction with the VM<a href="#interaction-with-the-vm" class="hash-link" aria-label="Direct link to Interaction with the VM" title="Direct link to Interaction with the VM">​</a></h3><p>At runtime, the VM will deserialize the bytecode from the file and interpret
it. A few components are involved:
BytecodeModule: This is the in-memory representation of the whole bytecode
file, containing all the bytecode functions. During both serialization and
deserialization, this data structure is generated, as a static representation
of the whole file.</p><ul><li>BytecodeFunction: This is the in-memory representation of a function’s
bytecode.</li><li>RuntimeModule: This is the dynamic version of the bytecode module, containing
necessary runtime information for interpretation.</li><li>CodeBlock: This is the dynamic version of the bytecode function, containing
necessary runtime information to execute a function.</li><li>Domain: A GC-managed proxy which references a set of RuntimeModules, acting as
a bridge between the GC heap and the C++ heap.</li><li>JSFunction: This is the Function object in JavaScript.</li></ul><p>It is important (and tricky) to efficiently manage the memory and ownership of
these objects properly at runtime. The following figure demonstrates it. Own
means one manages the memory of the other through unique_ptr; Pointer means one
has a raw pointer to the other, without any ownership. Indirectly Own is a
special kind of ownership, which will be explained below. To summarize the
ownership:</p><ul><li>JSFunction is a JavaScript object, and hence managed by the heap/garbage
collector directly.</li><li>JSFunction owns a GC-visible reference to a Domain, and a pointer to the
corresponding CodeBlock to execute.</li><li>CodeBlock contains a pointer to both the RuntimeModule to access runtime
information, as well as a pointer to the corresponding BytecodeFunction which
contains the static function bytecode to execute.</li><li>BytecodeModule owns a list of BytecodeFunction.</li><li>RuntimeModule owns a list of CodeBlock, as well as the corresponding
BytecodeModule.</li><li>Domain owns one or more RuntimeModule. This is the mechanism by which an extant
JSFunction keeps the backing bytecode alive.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="interpreter">Interpreter<a href="#interpreter" class="hash-link" aria-label="Direct link to Interpreter" title="Direct link to Interpreter">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="garbage-collector">Garbage Collector<a href="#garbage-collector" class="hash-link" aria-label="Direct link to Garbage Collector" title="Direct link to Garbage Collector">​</a></h2></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/hermes/blob/HEAD/website/../doc/Design.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2020-12-12T07:36:13.000Z">Dec 12, 2020</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/memory-profilers"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Memory Profilers</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/ir"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Design of the IR</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#json-estree-parser" class="table-of-contents__link toc-highlight">JSON estree parser</a></li><li><a href="#javascript-parser" class="table-of-contents__link toc-highlight">JavaScript parser</a></li><li><a href="#irgen" class="table-of-contents__link toc-highlight">IRGen</a></li><li><a href="#hermes-bytecode-generator" class="table-of-contents__link toc-highlight">Hermes Bytecode Generator</a><ul><li><a href="#hermes-bytecode-instructions" class="table-of-contents__link toc-highlight">Hermes Bytecode Instructions</a></li><li><a href="#bytecode-file-format" class="table-of-contents__link toc-highlight">Bytecode File Format</a></li><li><a href="#serialization--deserialization" class="table-of-contents__link toc-highlight">Serialization / Deserialization</a></li><li><a href="#interaction-with-the-vm" class="table-of-contents__link toc-highlight">Interaction with the VM</a></li></ul></li><li><a href="#interpreter" class="table-of-contents__link toc-highlight">Interpreter</a></li><li><a href="#garbage-collector" class="table-of-contents__link toc-highlight">Garbage Collector</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/language-features">Language Features</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/building-and-running">Building and Running</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/emscripten">Building with Emscripten</a></li></ul></div><div class="col footer__col"><div class="footer__title">Integrations</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://reactnative.dev/docs/hermes" target="_blank" rel="noopener noreferrer" class="footer__link-item">Using with React Native</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/react-native-integration">Using a custom build with React Native</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/HermesEngine" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://github.com/facebook/hermes" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookies<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright © 2023 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.79f494e2.js"></script>
<script src="/assets/js/main.c24be046.js"></script>
</body>
</html>